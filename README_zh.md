<h1>WebGLM: åŸºäºäººç±»åå¥½çš„é«˜æ•ˆç½‘ç»œå¢å¼ºé—®ç­”ç³»ç»Ÿ</h1>

<p align="center">ğŸ“ƒ <a href="https://arxiv.org/pdf/2306.07906.pdf" target="_blank">è®ºæ–‡ (KDD 2023)</a>

æœ¬é¡¹ç›®ä¸º WebGLM çš„å®˜æ–¹å®ç°ã€‚

https://github.com/THUDM/WebGLM/assets/129033897/d2e1dd35-6340-4175-ac2d-fd585daa17cf

_Read this in [English](README.md)._

<!-- TOC -->

-   [æ¦‚è¿°](#æ¦‚è¿°)
    -   [ç‰¹ç‚¹](#ç‰¹ç‚¹)
-   [å¼€å‘å‡†å¤‡](#å¼€å‘å‡†å¤‡)
    -   [å‡†å¤‡ä»£ç å’Œç¯å¢ƒ](#å‡†å¤‡ä»£ç å’Œç¯å¢ƒ)
    -   [å‡†å¤‡ SerpAPI å¯†é’¥](#å‡†å¤‡serpapiå¯†é’¥)
    -   [ä¸‹è½½æ£€ç´¢å™¨æƒé‡](#ä¸‹è½½æ£€ç´¢å™¨æƒé‡)
-   [å°è¯• WebGLM](#å°è¯•webglm)
    -   [å¯¼å‡ºç¯å¢ƒå˜é‡](#å¯¼å‡ºç¯å¢ƒå˜é‡)
    -   [ä»¥å‘½ä»¤è¡Œç•Œé¢è¿è¡Œ](#ä»¥å‘½ä»¤è¡Œç•Œé¢è¿è¡Œ)
    -   [ä»¥ Web æœåŠ¡å½¢å¼è¿è¡Œ](#ä»¥WebæœåŠ¡å½¢å¼è¿è¡Œ)
-   [è®­ç»ƒ WebGLM](#è®­ç»ƒwebglm)
    -   [è®­ç»ƒç”Ÿæˆå™¨](#è®­ç»ƒç”Ÿæˆå™¨)
        -   [å‡†å¤‡æ•°æ®](#å‡†å¤‡æ•°æ®)
        -   [è®­ç»ƒ](#è®­ç»ƒ)
    -   [è®­ç»ƒæ£€ç´¢å™¨](#è®­ç»ƒæ£€ç´¢å™¨)
        -   [å‡†å¤‡æ•°æ®](#å‡†å¤‡æ•°æ®-1)
        -   [è®­ç»ƒ](#è®­ç»ƒ-1)
-   [è¯„æµ‹](#è¯„æµ‹)
-   [å®é™…åº”ç”¨æ¡ˆä¾‹](#å®é™…åº”ç”¨æ¡ˆä¾‹)
-   [å¼•ç”¨](#å¼•ç”¨)

# æ¦‚è¿°

![paper](./assets/main_process.png)

WebGLM æ—¨åœ¨ä½¿ç”¨ 10 äº¿å‚æ•°çš„é€šç”¨è¯­è¨€æ¨¡å‹ï¼ˆGLMï¼‰æä¾›ä¸€ç§é«˜æ•ˆä¸”ä½æˆæœ¬çš„ç½‘ç»œå¢å¼ºé—®ç­”ç³»ç»Ÿã€‚å®ƒæ—¨åœ¨é€šè¿‡å°†ç½‘ç»œæœç´¢å’Œå¬å›åŠŸèƒ½é›†æˆåˆ°é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹ä¸­ä»¥è¿›è¡Œå®é™…åº”ç”¨çš„éƒ¨ç½²ã€‚

## ç‰¹ç‚¹

-   **å¤§æ¨¡å‹å¢å¼ºæ£€ç´¢å™¨**ï¼šå¢å¼ºäº†ç›¸å…³ç½‘ç»œå†…å®¹çš„æ£€ç´¢èƒ½åŠ›ï¼Œä»¥æ›´å¥½åœ°å‡†ç¡®å›ç­”é—®é¢˜ã€‚
-   **è‡ªä¸¾ç”Ÿæˆå™¨**ï¼šåˆ©ç”¨ GLM çš„èƒ½åŠ›ä¸ºé—®é¢˜ç”Ÿæˆå›å¤ï¼Œæä¾›è¯¦ç»†çš„ç­”æ¡ˆã€‚
-   **åŸºäºäººç±»åå¥½çš„æ‰“åˆ†å™¨**ï¼šé€šè¿‡ä¼˜å…ˆè€ƒè™‘äººç±»åå¥½æ¥è¯„ä¼°ç”Ÿæˆå›å¤çš„è´¨é‡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿäº§ç”Ÿæœ‰ç”¨å’Œå¸å¼•äººçš„å†…å®¹ã€‚

# å¼€å‘å‡†å¤‡

## å‡†å¤‡ä»£ç å’Œç¯å¢ƒ

å…‹éš†æ­¤ä»“åº“ï¼Œå¹¶å®‰è£…æ‰€éœ€ç¬¬ä¸‰æ–¹åº“

```bash
pip install -r requirements.txt
```

å®‰è£… Nodejsã€‚

```bash
apt install nodejs # å¦‚æœä½ ä½¿ç”¨Ubuntu
```

å®‰è£… playwright ä¾èµ–é¡¹ã€‚

```bash
playwright install
```

å¦‚æœä½ çš„ä¸»æœºä¸­æ²¡æœ‰å®‰è£…æµè§ˆå™¨ç¯å¢ƒï¼Œåˆ™éœ€è¦å®‰è£…ã€‚ä¸ç”¨æ‹…å¿ƒï¼Œå¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œplaywright ä¼šåœ¨é¦–æ¬¡æ‰§è¡Œæ—¶å‡ºç°è¯´æ˜ã€‚

## å‡†å¤‡ SerpAPI å¯†é’¥

åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ SerpAPI è·å–æœç´¢ç»“æœã€‚ä½ éœ€è¦ä»[è¿™é‡Œ](https://serpapi.com/)è·å– SerpAPI å¯†é’¥ã€‚

ç„¶åå°†ç¯å¢ƒå˜é‡`SERPAPI_KEY`è®¾ç½®ä¸ºä½ çš„å¯†é’¥ã€‚

æˆ–è€…ï¼Œä½ å¯ä»¥é€šè¿‡ playwright ä½¿ç”¨ Bingã€‚ä½ å¯ä»¥åœ¨ WebGLM çš„å¯åŠ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  `--searcher bing` ä»¥ä½¿ç”¨ Bing æœç´¢ã€‚

```bash
export SERPAPI_KEY="YOUR KEY"
```

## ä¸‹è½½æ£€ç´¢å™¨æƒé‡

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»[æ¸…åäº‘](https://cloud.tsinghua.edu.cn/d/54056861b2f34bbfb3f9/)ä¸‹è½½æ£€ç´¢å™¨çš„æƒé‡ã€‚

ä½ å¯ä»¥é€šè¿‡ `--save SAVE_PATH` æ‰‹åŠ¨æŒ‡å®šæ£€ç´¢å™¨æƒé‡çš„ä¿å­˜è·¯å¾„ã€‚

```bash
python download.py retriever-pretrained-checkpoint
```

# å°è¯• WebGLM

åœ¨è¿è¡Œä»£ç ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„è®¾å¤‡ç©ºé—´è¶³å¤Ÿã€‚

## å¯¼å‡ºç¯å¢ƒå˜é‡

å°†ç¯å¢ƒå˜é‡`WEBGLM_RETRIEVER_CKPT`è®¾å®šä¸ºæ£€ç´¢å™¨æƒé‡çš„è·¯å¾„ã€‚å¦‚æœä½ å·²å°†æ£€ç´¢å™¨æƒé‡ä¸‹è½½åˆ°é»˜è®¤è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œä»¥ä¸‹å‘½ä»¤è¡Œã€‚

```bash
export WEBGLM_RETRIEVER_CKPT=./download/retriever-pretrained-checkpoint
```

## ä»¥å‘½ä»¤è¡Œç•Œé¢è¿è¡Œ

ä½ å¯ä»¥å°è¯• WebGLM-2B æ¨¡å‹ï¼š

```bash
python cli_demo.py -w THUDM/WebGLM-2B
```

æˆ–ç›´æ¥å°è¯• WebGLM-10B æ¨¡å‹ï¼š

```bash
python cli_demo.py
```

å¦‚æœä½ æƒ³ä½¿ç”¨ Bing æœç´¢è€Œä¸æ˜¯ SerpAPIï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  `--searcher bing`ï¼Œä¾‹å¦‚ï¼š

```bash
python cli_demo.py -w THUDM/WebGLM-2B --searcher bing
```

## ä»¥ Web æœåŠ¡å½¢å¼è¿è¡Œ

ä½¿ç”¨ä¸ `cli_demo.py` ç›¸åŒçš„å‚æ•°è¿è¡Œ `web_demo.py`ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ Bing æœç´¢ä½¿ç”¨ WebGLM-2B æ¨¡å‹ï¼š

```bash
python web_demo.py -w THUDM/WebGLM-2B --searcher bing
```

# è®­ç»ƒ WebGLM

## è®­ç»ƒç”Ÿæˆå™¨

### å‡†å¤‡æ•°æ®

è¿è¡Œä¸‹é¢çš„å‘½ä»¤è¡Œä»[æ¸…åäº‘](https://cloud.tsinghua.edu.cn/d/ae204894f2e842f19a3f/)ä¸‹è½½è®­ç»ƒæ•°æ®ã€‚

```bash
python download.py generator-training-data
```

å®ƒå°†è‡ªåŠ¨ä¸‹è½½æ‰€æœ‰æ•°æ®ï¼Œå¹¶å°†å®ƒä»¬é¢„å¤„ç†æˆå¯ä»¥ç«‹å³åœ¨`./download`ä¸­ä½¿ç”¨çš„ seq2seq æ ¼å¼ã€‚

### è®­ç»ƒ

è¯·å‚è€ƒ[GLM ä»“åº“](https://github.com/THUDM/GLM#train-with-your-own-data)è¿›è¡Œ seq2seq è®­ç»ƒã€‚

## è®­ç»ƒæ£€ç´¢å™¨

### å‡†å¤‡æ•°æ®

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è¡Œï¼Œä»[æ¸…åäº‘](https://cloud.tsinghua.edu.cn/d/fa5e6eb1afac4f08a4c6/)ä¸‹è½½è®­ç»ƒæ•°æ®ã€‚

```bash
python download.py retriever-training-data
```

### è®­ç»ƒ

è¿è¡Œä»¥ä¸‹å‘½ä»¤è¡Œæ¥è®­ç»ƒæ£€ç´¢å™¨ã€‚å¦‚æœä½ å·²ç»åœ¨é»˜è®¤è·¯å¾„ä¸‹è½½äº†æ£€ç´¢å™¨è®­ç»ƒæ•°æ®ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œä»¥ä¸‹å‘½ä»¤è¡Œã€‚

```bash
python train_retriever.py --train_data_dir ./download/retriever-training-data
```

# è¯„æµ‹

ä½ å¯ä»¥åœ¨ TriviaQAã€WebQuestions å’Œ NQ Open ä¸Šé‡ç°æˆ‘ä»¬çš„ç»“æœã€‚ä»¥ TriviaQA ä¸ºä¾‹ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤è¡Œï¼š

```bash
bash scripts/triviaqa.sh
```

å¹¶å¼€å§‹è¿›è¡Œè¯„æµ‹ã€‚

# çœŸå®åº”ç”¨æ¡ˆä¾‹

æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](assets/cases)æŸ¥çœ‹ä¸€äº› WebGLM å®é™…åº”ç”¨åœºæ™¯çš„ç¤ºä¾‹ã€‚

# å¼•ç”¨

å¦‚æœæ‚¨é’ˆå¯¹æ‚¨çš„ç ”ç©¶ä½¿ç”¨äº†è¿™ä¸ªä»£ç ï¼Œè¯·å¼•ç”¨æˆ‘ä»¬çš„è®ºæ–‡ã€‚

```
@misc{liu2023webglm,
    title={WebGLM: Towards An Efficient Web-Enhanced Question Answering System with Human Preferences},
    author={Xiao Liu and Hanyu Lai and Hao Yu and Yifan Xu and Aohan Zeng and Zhengxiao Du and Peng Zhang and Yuxiao Dong and Jie Tang},
    year={2023},
    eprint={2306.07906},
    archivePrefix={arXiv},
    primaryClass={cs.CL}
}
```

> è¯¥ä»“åº“å·²è¿›è¡Œç®€åŒ–ä»¥ä¾¿äºéƒ¨ç½²ã€‚
